-- Old Roll Call Table (existing records)
CREATE TABLE O_RollCall (
    RollNo NUMBER(10) PRIMARY KEY,
    Name   VARCHAR2(30),
    Branch VARCHAR2(20)
);

-- New Roll Call Table (new records)
CREATE TABLE N_RollCall (
    RollNo NUMBER(10),
    Name   VARCHAR2(30),
    Branch VARCHAR2(20)
);

-- Old data
INSERT INTO O_RollCall VALUES (1, 'Amit', 'Computer');
INSERT INTO O_RollCall VALUES (2, 'Sneha', 'IT');
INSERT INTO O_RollCall VALUES (3, 'Raj', 'ENTC');

-- New data
INSERT INTO N_RollCall VALUES (2, 'Sneha', 'IT');      -- duplicate (should skip)
INSERT INTO N_RollCall VALUES (3, 'Raj', 'ENTC');      -- duplicate (should skip)
INSERT INTO N_RollCall VALUES (4, 'Rahul', 'Mech');    -- new (should insert)
INSERT INTO N_RollCall VALUES (5, 'Geeta', 'Civil');   -- new (should insert)

COMMIT;

SET SERVEROUTPUT ON;

DECLARE
  -- Variables to hold one row at a time
  v_roll   N_RollCall.RollNo%TYPE;
  v_name   N_RollCall.Name%TYPE;
  v_branch N_RollCall.Branch%TYPE;

  -- Parameterized cursor: accepts roll number
  CURSOR c_new(p_roll NUMBER) IS
    SELECT RollNo, Name, Branch
    FROM N_RollCall
    WHERE RollNo = p_roll;

BEGIN
  -- Loop through each record from N_RollCall
  FOR rec IN (SELECT * FROM N_RollCall) LOOP
  
    -- Check if this RollNo already exists in O_RollCall
    DECLARE
      v_count NUMBER;
    BEGIN
      SELECT COUNT(*) INTO v_count
      FROM O_RollCall
      WHERE RollNo = rec.RollNo;

      -- If record doesn't exist, fetch it using cursor and insert
      IF v_count = 0 THEN
        OPEN c_new(rec.RollNo);
        FETCH c_new INTO v_roll, v_name, v_branch;
        
        INSERT INTO O_RollCall VALUES (v_roll, v_name, v_branch);
        DBMS_OUTPUT.PUT_LINE('Inserted: ' || v_roll || ' - ' || v_name);
        
        CLOSE c_new;
      ELSE
        DBMS_OUTPUT.PUT_LINE('Skipped (already exists): ' || rec.RollNo || ' - ' || rec.Name);
      END IF;
    END;
  END LOOP;

  DBMS_OUTPUT.PUT_LINE('--- Merge Completed ---');
END;
/

SELECT * FROM O_RollCall;
